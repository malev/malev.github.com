<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <!-- Meta information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Marcos Vanetta (malev)" />
  <meta name="description" content="Authorship and collaboration in open source projects"/>
  <!--Facebook meta -->
  <meta property="og:title" content="Marcos Alejandro Vanetta (malev)" />
  <meta property="og:description" content="Authorship and collaboration in open source projects" />
  <meta property="og:image" content="/images/malev_logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- End of facebook meta -->

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

  <!-- Homepage CSS -->
  <!-- <link rel="stylesheet" href="/css/bootstrap.css" type="text/css" media="screen, projection" /> -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" type="text/css" media="screen, projection" />
  
  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu&v2' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700&v2' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--  <script src="/js/bootstrap.min.js"></script>-->
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>Single var pattern - Javascript</title>
</head>
<body>
<div class="container">
  <div class="site">
  <div id="post">
    <div class="title">
      <h1><a href='/#blog' name='blog'>Blog posts</a></h1>
    </div>
    <h1>Single var pattern - Javascript</h1>

<p>Javascript es un lenguaje muy particular, cualquier variable que no declaremos se convierte en propiedad del global object (objeto global), es decir se convierte en una <strong>variable global</strong>. Que en el caso de los browsers, es el mismísimo window. Aquí un ejemplo extraído de [1]:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">myglobal</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>  <span class="c1">// antipattern  </span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myglobal</span><span class="p">);</span>    <span class="c1">// &quot;hello&quot;  </span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">myglobal</span><span class="p">);</span> <span class="c1">// &quot;hello&quot;</span>
</code></pre>
</div>


<p>Ahora mostramos como una variable no declarada (resultado) es visible aún fuera de la función donde apareció por primera vez:</p>

<div class="highlight"><pre><code class="javascript"><span class="o">&gt;&gt;&gt;</span> <span class="kd">function</span> <span class="nx">cuadrado</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span> <span class="nx">resultado</span> <span class="o">=</span> <span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">;</span> <span class="k">return</span> <span class="nx">resultado</span> <span class="p">}</span>
<span class="kc">undefined</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nx">cuadrado</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="mi">81</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nx">resultado</span>
<span class="mi">81</span>
</code></pre>
</div>


<p>Nota: Podemos probar los ejemplos en la consola de firebug en firefox.</p>

<p><strong>Las variables globales son evil</strong>(malas)
Al menos eso me han dicho. Lo que sí hacen o pueden hacer es interferir con alguna librería que estemos usando y generarnos comportamientos inesperados en nuestros propios scripts. Lo ideal es tratar de minimizarlas. ¿Cómo?</p>

<p><strong>Usando variables locales</strong>
Una variable local es aquella que se declara dentro de una función, siendo local y existiendo únicamente en esa función:</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">cuadrado</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">resultado</span> <span class="o">=</span> <span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">resultado</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>


<p>Demo:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">js</span><span class="o">&gt;</span> <span class="kd">function</span> <span class="nx">cuadrado</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span> <span class="kd">var</span> <span class="nx">resultado</span> <span class="o">=</span> <span class="nx">x</span><span class="o">*</span><span class="nx">x</span><span class="p">;</span> <span class="k">return</span> <span class="nx">resultado</span> <span class="p">}</span>
<span class="nx">js</span><span class="o">&gt;</span> <span class="nx">cuadrado</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="mi">81</span>
<span class="nx">js</span><span class="o">&gt;</span> <span class="nx">resultado</span>
<span class="nx">js</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">line</span> <span class="mi">4</span><span class="o">:</span> <span class="nx">uncaught</span> <span class="nx">JavaScript</span> <span class="nx">runtime</span> <span class="nx">exception</span><span class="o">:</span> <span class="nx">ReferenceError</span><span class="o">:</span> <span class="s2">&quot;resultado&quot;</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">defined</span><span class="p">.</span>
<span class="nx">at</span> <span class="o">:</span><span class="mi">4</span>

<span class="nx">js</span><span class="o">&gt;</span>
</code></pre>
</div>


<p><strong>Listo! entonces usemos solo variables locales! pero y Dónde está el single var pattern?</strong>
En javascript podemos declarar varias variables <strong>locales</strong> en una sola línea: var a, b; (No hace falta que le asignemos un valor). Usando el mismo criterio, podemos escribir un único <strong>var</strong> arriba dentro de la función y de ahí separar todo con comas.</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">sum</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">,</span>
    <span class="nx">myobject</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">j</span><span class="p">;</span>
<span class="c1">// function body...</span>
<span class="p">}</span>
</code></pre>
</div>


<p>No parece nada del otro mundo, pero trae algunas ventajas y desventajas: tenemos todas las variables ubicadas en un solo lugar, evita que nos olvidemos el <strong>var</strong> y previene <strong>hoisting</strong>. Desventajas: queda feo.</p>

<p><strong>Hoising</strong>
Javascript considera que todas las declaraciones de variables se realizan en la parte de arriba de la función. No importa si la declaramos luego en el medio del código, aún usando <strong>var</strong>. En ese caso, se declararía arriba con un valor indefinido. El ejemplo a continuación ilustra el fenomeno.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">myname</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span><span class="p">;</span> <span class="c1">// global variable  </span>
<span class="kd">function</span> <span class="nx">func</span><span class="p">()</span> <span class="p">{</span>  
  <span class="nx">alert</span><span class="p">(</span><span class="nx">myname</span><span class="p">);</span> <span class="c1">// &quot;undefined&quot;  </span>
  <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="s2">&quot;local&quot;</span><span class="p">;</span>  
  <span class="nx">alert</span><span class="p">(</span><span class="nx">myname</span><span class="p">);</span> <span class="c1">// &quot;local&quot;  </span>
  <span class="p">}</span>
<span class="nx">func</span><span class="p">();</span>
</code></pre>
</div>


<p><strong>Resources</strong>
[1] <a href="http://net.tutsplus.com/tutorials/javascript-ajax/the-essentials-of-writing-high-quality-javascript/">http://net.tutsplus.com/tutorials/javascript-ajax/the-essentials-of-writing-high-quality-javascript/</a>
[2] <a href="http://snook.ca/archives/javascript/global_variable">http://snook.ca/archives/javascript/global_variable</a>
[3] <a href="http://2007-2010.lovemikeg.com/2010/01/19/responsible-javascript-globals/">http://2007-2010.lovemikeg.com/2010/01/19/responsible-javascript-globals/</a>
[4] <a href="http://www.keyframesandcode.com/resources/javascript/deconstructed/jquery/">http://www.keyframesandcode.com/resources/javascript/deconstructed/jquery/</a></p>

    
      <div class="comments" style="margin-top: 20px;">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'malevsblog'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    
  </div>
  <div id="related">
    <h2><a href='/about.html'>About the author</a></h2>
  </div>

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
        <li><span>01 Jun 2012</span> &raquo; <a href="/backbone-first-steps">Learning Javascript</a></li>
      
        <li><span>13 Apr 2012</span> &raquo; <a href="/nginx-passenger-and-php">Nginx, passenger and PHP</a></li>
      
        <li><span>09 Apr 2012</span> &raquo; <a href="/learning-javascript">Learning Javascript</a></li>
      
    </ul>
  </div>
</div>
  <div class="site">
    <div class="footer">
      <div class="contact">
        <p style="margin:0;">
          <a href="/about.html">Marcos Vanetta</a> <strong>(malev)</strong><br />
          Software engineer<br />
          <a href="http://github.com/malev/">github</a> | <a href="http://twitter.com/malev/">twitter</a> | <a href="http://launchpad.net/~marcosvanetta">Launchpad</a>
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/malev">
          <img src="/images/rss-logo.png" alt="Subscribe to RSS Feed" style="width: 64px;"/>
        </a>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/malev"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29516046-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
