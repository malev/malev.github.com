<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <!-- Meta information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Marcos Vanetta (malev)" />
  <meta name="description" content="Authorship and collaboration in open source projects"/>
  <!--Facebook meta -->
  <meta property="og:title" content="Marcos Alejandro Vanetta (malev)" />
  <meta property="og:description" content="Authorship and collaboration in open source projects" />
  <meta property="og:image" content="/images/malev_logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- End of facebook meta -->

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

  <!-- Homepage CSS -->
  <!-- <link rel="stylesheet" href="/css/bootstrap.css" type="text/css" media="screen, projection" /> -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" type="text/css" media="screen, projection" />
  
  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu&v2' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700&v2' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--  <script src="/js/bootstrap.min.js"></script>-->
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>Galletas en Sinatra (Cookies)</title>
</head>
<body>
<div class="container">
  <div class="site">
  <div id="post">
    <div class="title">
      <h1><a href='/#blog' name='blog'>Blog posts</a></h1>
    </div>
    <h1>Galletas en Sinatra (Cookies)</h1>

<p>¿Qué son estas galletas? Una cookie es un fragmento de información que se almacena en el disco duro del visitante de una página web a través de su navegador (<strong>limitadas a 4k</strong>). Esta información puede ser luego recuperada por el servidor en posteriores visitas.
Se usan por ejemplo para llevar el control de usuarios y así evitar que el usuario tenga que validar sus datos cada vez que accede a una determinada página. Un dato a tener en cuenta es que las cookies no identifican a una persona, sino a una combinación de una computadora y un navegador.
<strong>
Atributos:</strong>
Par nombre / valor: nombre=valor. Caducidad: Una vez que las cookies caducan, dejan de ser enviadas al navegador, es decir, dejan de ser usadas (si no se especifica, el default es cuando se cierra la sesión). Las cookies pueden ser renovadas. Y por último el path y dominio. Estos últimos son los utilizados para reenviar la cookie al servidor.
<strong>Ejemplo1:</strong>
Set-Cookie: name=newvalue; expires=date; path=/; domain= .example.org.
<strong>Ejemplo 2:</strong>
Set-Cookie: RMID=732423sdfs73242; expires=Fri, 31-Dec-2010 23:59:59 GMT; path=/; domain=.example.net</p>

<p><strong>Casos en que dejan de ser usadas:</strong>
Finaliza la sesión (cerrar el navegador, a menos que sea declarada persistente). Ha expirado. La cookie ha sido borrada.
<strong>Nota:</strong> las cookies con la fecha de expiración especificada son las denomiadas persistentes.</p>

<p><strong>Cookies en sinatra</strong></p>

<blockquote>response.set_cookie("foo", "bar")
request.set_cookie("foo", {:value => "bar", :expiration => Time.today + 94608000}
set_cookie("thing", { :value => "thing2",
                      :domain => “blog.malev.com.ar”,
                      :path => “/”,
                      :expires => Time.today,
                      :secure => true,
                      :httponly => true } )</blockquote>


<p><strong>Leyendo las cookies: </strong></p>

<blockquote>cookies["foo"] # => "bar"</blockquote>


<p><strong>Actualizado</strong></p>

<p><strong>Otra forma:</strong></p>

<blockquote>enable :sessions
get '/' do
  session["user"] ||= “malev”
  haml :index
end</blockquote>


<p>Actualmente Sinatra no tiene otra forma de implentar sesiones o sessions. Pero según nos dice Julio [3], en un comentario en este mismo post, <em>"pero, como Sinatra es basicamente una capa de abstracción que se encuentra por sobre Rack, ademas podes usar directamente los middlewares existentes (como el soporte para MemCache, Pool, Cookies) en Rack o, inclusive, crear uno propio"</em>. Christopher, en una respuesta a una consulta mía en la lista de correos de Sinatra me comentó que escribió <a href="http://www.gittr.com/index.php/archive/using-alternate-session-stores-with-sinatra/">este</a> artículo, donde detalla como hacer uso de Rack para implementar formas alternativas de sessions.</p>

<p><strong>Referencias:</strong>
[1] <a href="http://www.gittr.com/index.php/archive/sinatra-cookie-handling-in-0-9-4/">gittr</a>
[2] <a href="http://www.sinatrarb.com/api/index.html">Sinatra API</a>
[3]  <a href="http://rubylearning.com/blog/2009/09/30/cookie-based-sessions-in-sinatra/comment-page-1/#comment-119528">Julio Javier Cicchelli</a></p>

    
      <div class="comments" style="margin-top: 20px;">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'malevsblog'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    
  </div>
  <div id="related">
    <h2><a href='/about.html'>About the author</a></h2>
  </div>

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
        <li><span>01 Jun 2012</span> &raquo; <a href="/backbone-first-steps">Learning Javascript</a></li>
      
        <li><span>13 Apr 2012</span> &raquo; <a href="/nginx-passenger-and-php">Nginx, passenger and PHP</a></li>
      
        <li><span>09 Apr 2012</span> &raquo; <a href="/learning-javascript">Learning Javascript</a></li>
      
    </ul>
  </div>
</div>
  <div class="site">
    <div class="footer">
      <div class="contact">
        <p style="margin:0;">
          <a href="/about.html">Marcos Vanetta</a> <strong>(malev)</strong><br />
          Software engineer<br />
          <a href="http://github.com/malev/">github</a> | <a href="http://twitter.com/malev/">twitter</a> | <a href="http://launchpad.net/~marcosvanetta">Launchpad</a>
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/malev">
          <img src="/images/rss-logo.png" alt="Subscribe to RSS Feed" style="width: 64px;"/>
        </a>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/malev"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29516046-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
