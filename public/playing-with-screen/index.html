<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <!-- Meta information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Marcos Vanetta (malev)" />
  <meta name="description" content="Authorship and collaboration in open source projects"/>
  <!--Facebook meta -->
  <meta property="og:title" content="Marcos Alejandro Vanetta (malev)" />
  <meta property="og:description" content="Authorship and collaboration in open source projects" />
  <meta property="og:image" content="/images/malev_logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- End of facebook meta -->

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

  <!-- Homepage CSS -->
  <!-- <link rel="stylesheet" href="/css/bootstrap.css" type="text/css" media="screen, projection" /> -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" type="text/css" media="screen, projection" />
  
  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu&v2' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700&v2' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--  <script src="/js/bootstrap.min.js"></script>-->
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>Playing with screen</title>
</head>
<body>
<div class="container">
  <div class="site">
  <div id="post">
    <div class="title">
      <h1><a href='/#blog' name='blog'>Blog posts</a></h1>
    </div>
    <h1>Playing with screen</h1>

<p>En el pycamp [1], vi mucha gente usando <strong>screen</strong> para manejar su terminal. Luego de ponerme a investigar un poquito descubrí que se puede hacer cosas bastante interesantes con este nuevo programilla. Pero, antes, de qué estoy hablando? <strong>GNU Screen</strong> es un programa informático multiplexor de terminales desarrollado por el proyecto GNU. [2]</p>

<p><strong>Qué cosas tiene de bueno?</strong></p>

<ul>
<li>Muy configurable</li>
<li>Permite dividir la pantalla</li>
<li>Permite organizar muchas terminales virtuales</li>
</ul>


<p>El último punto es el más interesante, ya que nos permite automatizar tareas que hacemos en nuestra consola. Digamos por ejemplo que tenemos una aplicación en rails 3. En la misma abrimos: Unicorn (server), una consola de rails, spork y watchr para nuestros test y por último queremos hacer un <strong>tail -f al log</strong>. Hacer todo esto siempre puede ser un poco molesto. La solución, obviamente: screen:</p>

<p>Primero una introducción: abrimos <strong>screen</strong> con ...</p>

<blockquote><p>screen</p></blockquote>

<p>En principio no hay grandes cambios, pero si nos pasamos al modo comando: <strong>Ctrl + A</strong>, las cosas empiezan a mejorar. Para crear crear una segunda instancia de la terminal (Ctrl +A c) y navegamos entre ellas con n (next) o p (previous), siempre en el modo comando. También podemos dividir una ventana de manera horizontal. Para esto, entramos a modo comando (Ctrl + A) y escribimos <strong>:split</strong>. Vemos que se dividió nuestra pantalla. Con "Ctrl+A tab" nos paseamos entre las mitades, y presionamos "c" para crear una nueva terminal en cualquiera de las divisiones.
Hasta aquí nada del otro mundo, pero luego de ver una presentación de Tim Charper, pude ver como automatizar tareas comunes de nuestros entornos de desarrollo. Empezamos con un poco de configuración:
<strong>/home/malev/.screerc</strong></p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># Remap escape char to C-\</span>
<span class="c1"># escape \034\034</span>
<span class="n">vbellwait</span> <span class="mi">0</span><span class="o">.</span><span class="mi">25</span>
<span class="n">startup_message</span> <span class="n">off</span>
<span class="n">shell</span> <span class="s2">&quot;-/bin/bash&quot;</span>
<span class="n">defscrollback</span> <span class="mi">5000</span>
<span class="n">chdir</span>

<span class="n">caption</span> <span class="n">always</span> <span class="s2">&quot;%{-u wk} %L=%-Lw%45&gt;%{+ Gk} %n%f* %t %{-}%+Lw%-0&lt; %=%{ck} %H | %M %d %c &quot;</span>

<span class="n">bind</span> <span class="n">j</span> <span class="n">focus</span> <span class="n">down</span>
<span class="n">bind</span> <span class="n">k</span> <span class="n">focus</span> <span class="n">up</span>
<span class="n">bind</span> <span class="n">t</span> <span class="n">focus</span> <span class="n">top</span>
<span class="n">bind</span> <span class="n">b</span> <span class="n">focus</span> <span class="n">bottom</span>
</code></pre>
</div>


<p>Este archivo hace algunas cosas interesante: elimina el cartel de bienvenida y mapea las teclas j y k como en vim para una navegación más simple. También nos configura b y t para pasarnos entre divisiones de manera más simple. Luego, dentro del directorio de una aplicación que estemos usando agregamos:
/home/malev/code/grouppet/screen</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># why use stuff instead of exec? Because if the process dies, the screen</span>
<span class="c1"># session will die with it, leaving you unable to see the backtrace. Also,</span>
<span class="c1"># it&#39;s easier to restart that way. But, your choice :)</span>
<span class="n">setenv</span> <span class="no">ROOT</span> <span class="s2">&quot;$HOME/code/grouppet&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;server&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">unicorn</span><span class="se">\015</span><span class="s2">&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;logs&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">tail -f log/development.log</span><span class="se">\015</span><span class="s2">&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;spork&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">spork</span><span class="se">\015</span><span class="s2">&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;watchr&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">rake watchr</span><span class="se">\015</span><span class="s2">&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;console&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">rails c</span><span class="se">\015</span><span class="s2">&quot;</span>

<span class="n">screen</span>
<span class="n">title</span> <span class="s2">&quot;shell&quot;</span>
<span class="n">stuff</span> <span class="s2">&quot;cd $ROOT</span><span class="se">\015</span><span class="s2">clear</span><span class="se">\015</span><span class="s2">&quot;</span>
</code></pre>
</div>


<p>La primer línea útil indica donde estamos parados. Luego crea varias screens y en cada una corre un comando: <strong>unicorn</strong>, los logs, <strong>spork</strong>, <strong>watchr</strong>, la consola y por último un shell limpio. Esto me permite tener mi entorno listo para empezar a trabajar con solo ejecutar:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">cd</span><span class="sr"> /home/m</span><span class="n">alev</span><span class="o">/</span><span class="n">code</span><span class="o">/</span><span class="n">grouppet</span>
<span class="n">screen</span> <span class="o">-</span><span class="n">c</span> <span class="n">screen</span>
</code></pre>
</div>


<p>Nota: Por supuesto podemos crear un alias para este comando y así tener todo más simple todavía.
<strong>Algunos comando útiles</strong></p>

<ul>
<li>C-a D : Sale de la terminal</li>
<li>C-a :quit : Sale de screen</li>
<li>C-a " : Muestra todas las screen abiertas</li>
<li>C-a ? : Muestra ayuda</li>
</ul>


<p><strong>Más información:</strong>
Quick reference: http://aperiodic.net/screen/quick_reference</p>

<p><strong>Resources</strong></p>

<ul>
<li>[1] http://blog.malev.com.ar/2011/03/31/pycamp-2011/</li>
<li>[2] http://es.wikipedia.org/wiki/GNU_Screen</li>
<li>[3] http://www.gnu.org/software/screen/</li>
<li>[4] http://www.debian-administration.org/articles/34</li>
<li>[5] http://www.gnu.org/software/screen/manual/screen.html</li>
</ul>


    
      <div class="comments" style="margin-top: 20px;">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'malevsblog'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    
  </div>
  <div id="related">
    <h2><a href='/about.html'>About the author</a></h2>
  </div>

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
        <li><span>01 Jun 2012</span> &raquo; <a href="/backbone-first-steps">Learning Javascript</a></li>
      
        <li><span>13 Apr 2012</span> &raquo; <a href="/nginx-passenger-and-php">Nginx, passenger and PHP</a></li>
      
        <li><span>09 Apr 2012</span> &raquo; <a href="/learning-javascript">Learning Javascript</a></li>
      
    </ul>
  </div>
</div>
  <div class="site">
    <div class="footer">
      <div class="contact">
        <p style="margin:0;">
          <a href="/about.html">Marcos Vanetta</a> <strong>(malev)</strong><br />
          Software engineer<br />
          <a href="http://github.com/malev/">github</a> | <a href="http://twitter.com/malev/">twitter</a> | <a href="http://launchpad.net/~marcosvanetta">Launchpad</a>
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/malev">
          <img src="/images/rss-logo.png" alt="Subscribe to RSS Feed" style="width: 64px;"/>
        </a>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/malev"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29516046-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
