<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <!-- Meta information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Marcos Vanetta (malev)" />
  <meta name="description" content="Authorship and collaboration in open source projects"/>
  <!--Facebook meta -->
  <meta property="og:title" content="Marcos Alejandro Vanetta (malev)" />
  <meta property="og:description" content="Authorship and collaboration in open source projects" />
  <meta property="og:image" content="/images/malev_logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- End of facebook meta -->

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

  <!-- Homepage CSS -->
  <!-- <link rel="stylesheet" href="/css/bootstrap.css" type="text/css" media="screen, projection" /> -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" type="text/css" media="screen, projection" />
  
  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu&v2' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700&v2' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--  <script src="/js/bootstrap.min.js"></script>-->
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>Hash, hashie y struct</title>
</head>
<body>
<div class="container">
  <div class="site">
  <div id="post">
    <div class="title">
      <h1><a href='/#blog' name='blog'>Blog posts</a></h1>
    </div>
    <h1>Hash, hashie y struct</h1>

<p>Bueno, los <strong>Hash</strong> o diccionarios casi no necesitan presentación, son colecciones de pares key-value, como arreglos, pero en vez de acceder a ellos por un posición, se puede acceder por un objeto, cualquiera sea su tipo [1]:</p>

<div class="highlight"><pre><code class="ruby"><span class="o">&gt;&gt;</span> <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;saludo&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="ss">:despedida</span> <span class="o">=&gt;</span> <span class="s2">&quot;adios&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:despedida</span><span class="o">=&gt;</span><span class="s2">&quot;adios&quot;</span><span class="p">,</span> <span class="s2">&quot;saludo&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">=&gt;</span><span class="mi">5</span><span class="p">}</span>
</code></pre>
</div>


<p>Una cosa importante, devuelven <strong>nil</strong> cuando intentamos acceder a una key que no existe:</p>

<div class="highlight"><pre><code class="ruby"><span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">[</span><span class="s2">&quot;no_existo&quot;</span><span class="o">]</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</code></pre>
</div>


<p>A nivel código, incluyen el módulo <strong>Enumerable</strong>, por lo que comparten muchos métodos con sus primos los arreglos, por ejemplo se puede interarlos:</p>

<div class="highlight"><pre><code class="ruby"><span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">each_pair</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="p">}</span>
</code></pre>
</div>


<p><strong>Agregando, buscando y eliminando elementos (con condicional):</strong></p>

<div class="highlight"><pre><code class="ruby"><span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">[</span><span class="s2">&quot;nuevo&quot;</span><span class="o">]</span> <span class="o">=</span> <span class="mi">89</span>
<span class="o">=&gt;</span> <span class="mi">89</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:despedida</span><span class="o">=&gt;</span><span class="s2">&quot;adios&quot;</span><span class="p">,</span> <span class="s2">&quot;nuevo&quot;</span><span class="o">=&gt;</span><span class="mi">89</span><span class="p">,</span> <span class="s2">&quot;saludo&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="o">=&gt;</span><span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">[</span><span class="s2">&quot;saludo&quot;</span><span class="o">]</span>
<span class="o">=&gt;</span> <span class="s2">&quot;hola&quot;</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">delete</span> <span class="s2">&quot;saludo&quot;</span>
<span class="o">=&gt;</span> <span class="s2">&quot;hola&quot;</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:despedida</span><span class="o">=&gt;</span><span class="s2">&quot;adios&quot;</span><span class="p">,</span> <span class="s2">&quot;nuevo&quot;</span><span class="o">=&gt;</span><span class="mi">89</span><span class="p">,</span> <span class="mi">2</span><span class="o">=&gt;</span><span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="n">nuevo</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:marcos</span> <span class="o">=&gt;</span> <span class="mi">27</span><span class="p">,</span> <span class="ss">:alvaro</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="ss">:diego</span> <span class="o">=&gt;</span> <span class="mi">17</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:marcos</span><span class="o">=&gt;</span><span class="mi">27</span><span class="p">,</span> <span class="ss">:alvaro</span><span class="o">=&gt;</span><span class="mi">25</span><span class="p">,</span> <span class="ss">:diego</span><span class="o">=&gt;</span><span class="mi">17</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="n">nuevo</span><span class="o">.</span><span class="n">delete_if</span> <span class="p">{</span> <span class="o">|</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">|</span> <span class="n">v</span> <span class="o">&lt;</span><span class="mi">18</span> <span class="p">}</span>
<span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:marcos</span><span class="o">=&gt;</span><span class="mi">27</span><span class="p">,</span> <span class="ss">:alvaro</span><span class="o">=&gt;</span><span class="mi">25</span><span class="p">}</span>
</code></pre>
</div>


<p><strong>Preguntando por elementos:</strong></p>

<div class="highlight"><pre><code class="ruby"><span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:despedida</span><span class="o">=&gt;</span><span class="s2">&quot;adios&quot;</span><span class="p">,</span> <span class="s2">&quot;nuevo&quot;</span><span class="o">=&gt;</span><span class="mi">89</span><span class="p">,</span> <span class="mi">2</span><span class="o">=&gt;</span><span class="mi">5</span><span class="p">}</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">has_key?</span> <span class="s2">&quot;nuevo&quot;</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">has_value?</span> <span class="mi">2</span>
<span class="o">=&gt;</span> <span class="kp">false</span>
</code></pre>
</div>


<p><strong>También tenemos un método fetch que nos acepta un número variable de argumentos:</strong>
1) Un key, que buscará en el hash, de no existir, tira una exception
2) Una key más un valor por defecto, si no existe la key, nos devuelve el valor por defecto
3) Una key y un bloque</p>

<div class="highlight"><pre><code class="ruby"><span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">fetch</span> <span class="ss">:despedida</span>
<span class="o">=&gt;</span> <span class="s2">&quot;adios&quot;</span>
<span class="o">&gt;&gt;</span> <span class="n">dic</span><span class="o">.</span><span class="n">fetch</span> <span class="s2">&quot;noexisto&quot;</span>
<span class="no">IndexError</span><span class="p">:</span> <span class="n">key</span> <span class="ow">not</span> <span class="n">found</span>
<span class="n">from</span> <span class="p">(</span><span class="n">irb</span><span class="p">):</span><span class="mi">14</span><span class="ss">:in</span> <span class="sb">`fetch&#39;</span>
<span class="sb">from (irb):14</span>
<span class="sb">&gt;&gt; dic.fetch &quot;noexisto&quot;, &quot;default&quot;</span>
<span class="sb">=&gt; &quot;default&quot;</span>
</code></pre>
</div>


<p><strong>¿Qué pasa cuando los Hashes ya no son suficientes?</strong>
Ahí entra hashie, una gema desarrollada por gente de intredea [2], que nos entrega unas cuantas clases para generar objetos similares a los hash, a los objetos de ActiveRecord, etc. Como casi todas las gemas, su código se encuentra en gihub [3]. Muy interesante:
1) Mash, un hash extendido, con comportamiento de pseudo objeto:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">mash</span> <span class="o">=</span> <span class="no">Hashie</span><span class="o">::</span><span class="no">Mash</span><span class="o">.</span><span class="n">new</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">name?</span> <span class="c1"># =&gt; false</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; nil</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;My Mash&quot;</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; &quot;My Mash&quot;</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">name?</span> <span class="c1"># =&gt; true</span>
    <span class="n">mash</span><span class="o">.</span><span class="n">inspect</span> <span class="c1"># =&gt;</span>
</code></pre>
</div>


<p>2) Dash, otro hash extendido, pero con una cantidad de propiedades discretas predefinidas. Pueden tomar valores por defecto.</p>

<div class="highlight"><pre><code class="ruby"><span class="k">class</span> <span class="nc">Person</span> <span class="o">&lt;</span> <span class="no">Hashie</span><span class="o">::</span><span class="no">Dash</span>
      <span class="n">property</span> <span class="ss">:name</span>
      <span class="n">property</span> <span class="ss">:email</span>
      <span class="n">property</span> <span class="ss">:occupation</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s1">&#39;Rubyist&#39;</span>
    <span class="k">end</span>
    <span class="nb">p</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">new</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; nil</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s1">&#39;abc@def.com&#39;</span>
    <span class="nb">p</span><span class="o">.</span><span class="n">occupation</span>   <span class="c1"># =&gt; &#39;Rubyist&#39;</span>
</code></pre>
</div>


<p>Por último, tenemos una opción desde la librería estandar, los <strong>Struct</strong>. Una opción interesante, sobre todo cuando necesitamos hardcodear alguna vista o algo por el estilo en Rails.</p>

<div class="highlight"><pre><code class="ruby"><span class="no">Customer</span> <span class="o">=</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:address</span><span class="p">)</span>
<span class="no">Customer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Dave&quot;</span><span class="p">,</span> <span class="s2">&quot;123 Main&quot;</span><span class="p">)</span>
</code></pre>
</div>


<p><strong>Resources</strong>
[1] http://www.ruby-doc.org/core/classes/Hash.html
[2] http://intridea.com/posts/hashie-the-hash-toolkit
[3] https://github.com/intridea/hashie</p>

    
      <div class="comments" style="margin-top: 20px;">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'malevsblog'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    
  </div>
  <div id="related">
    <h2><a href='/about.html'>About the author</a></h2>
  </div>

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
        <li><span>01 Jun 2012</span> &raquo; <a href="/backbone-first-steps">Learning Javascript</a></li>
      
        <li><span>13 Apr 2012</span> &raquo; <a href="/nginx-passenger-and-php">Nginx, passenger and PHP</a></li>
      
        <li><span>09 Apr 2012</span> &raquo; <a href="/learning-javascript">Learning Javascript</a></li>
      
    </ul>
  </div>
</div>
  <div class="site">
    <div class="footer">
      <div class="contact">
        <p style="margin:0;">
          <a href="/about.html">Marcos Vanetta</a> <strong>(malev)</strong><br />
          Software engineer<br />
          <a href="http://github.com/malev/">github</a> | <a href="http://twitter.com/malev/">twitter</a> | <a href="http://launchpad.net/~marcosvanetta">Launchpad</a>
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/malev">
          <img src="/images/rss-logo.png" alt="Subscribe to RSS Feed" style="width: 64px;"/>
        </a>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/malev"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29516046-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
