<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <!-- Meta information -->
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="Marcos Vanetta (malev)" />
  <meta name="description" content="Authorship and collaboration in open source projects"/>
  <!--Facebook meta -->
  <meta property="og:title" content="Marcos Alejandro Vanetta (malev)" />
  <meta property="og:description" content="Authorship and collaboration in open source projects" />
  <meta property="og:image" content="/images/malev_logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- End of facebook meta -->

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

  <!-- Homepage CSS -->
  <!-- <link rel="stylesheet" href="/css/bootstrap.css" type="text/css" media="screen, projection" /> -->
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/bootstrap-responsive.min.css" type="text/css" media="screen, projection" />
  
  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu&v2' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Cabin+Sketch:700&v2' rel='stylesheet' type='text/css'>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--  <script src="/js/bootstrap.min.js"></script>-->
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <title>Nginx, passenger and PHP</title>
</head>
<body>
<div class="container">
  <div class="site">
  <div id="post">
    <div class="title">
      <h1><a href='/#blog' name='blog'>Blog posts</a></h1>
    </div>
    <h1>Nginx, passenger and PHP</h1>

<p>Suele pasar, solemos llenar de cosas nuestros VPS, y bueno, tuvo que pasar, necesitaba un Wordpress en un VPS y debo admitir que extrañé Apache por unos minutos. Luego de googlear mucho encontré esta solución:</p>

<h2>Instalamos algunas cositas:</h2>

<blockquote><p>sudo yum -y install mysql-server php-fpm php-mysql php-pecl-apc</p></blockquote>

<p>Una buena práctica es ejecutar <strong>/usr/bin/mysql_secure_installation</strong> para dejar nuestro MySQL en perfectas condiciones.</p>

<p>En Ubuntu podríamos hacer:</p>

<blockquote><p>sudo apt-get install php5-cli php5-cgi php5-common php5-curl php5-dev php5-gd php5-imagick php5-mcrypt php5-mhash</p>

<p>sudo apt-get install php5-mysql libmysqld-dev</p></blockquote>

<h2>Instalando spawn-fcgi</h2>

<p><strong>spawn-fcgi</strong>[1] es un herramienta del proyecto Lighttp que nos ayuda a preparar el ambiente para FastCGI. Tenemos que hacerlo amigo de <strong>nginx</strong>.</p>

<blockquote><p>cd /tmp</p>

<p>wget http://www.lighttpd.net/download/spawn-fcgi-1.6.3.tar.gz</p>

<p>tar -xvzf spawn-fcgi-1.6.3.tar.gz</p>

<p>cd spawn-fcgi-1.6.3</p>

<p>./configure --prefix=/usr</p>

<p>make</p>

<p>sudo make install</p>

<p>sudo nano /usr/bin/php5-fcgi</p></blockquote>

<p>Y le pegamos esto:</p>

<blockquote><p>/usr/bin/spawn-fcgi -f /usr/bin/php-cgi -a 127.0.0.1 -p 49232 -C 2 -P /var/run/fastcgi-php.pid</p></blockquote>

<p>También vamos a necesitar crear un archivo de inicio para spawn-fcgi. Creamos <strong>/etc/init.d/php5-fcgi</strong> y le pegamos el contenido de <a href="https://gist.github.com/2373780">este gist</a>.</p>

<p>Cambiamos algunos permisos:</p>

<blockquote><p>sudo chmod +x /usr/bin/php5-fcgi</p>

<p>sudo chmod +x /etc/init.d/php5-fcgi</p>

<p>sudo update-rc.d php5-fcgi defaults</p></blockquote>

<p>y ahora a lo más (sarcamo on) divertido (sarcasmo off), recompilamos <strong>nginx</strong>:</p>

<p>Bajamos el código fuente:</p>

<blockquote><p>rvmsudo passenger-install-nginx-module</p></blockquote>

<p>Elegimos la opción 2 y le pasamos estos parámetros extras:</p>

<blockquote><p>--with-http_ssl_module --with-http_dav_module --with-http_gzip_static_module --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-client-body-temp-path=/var/lib/nginx/body --with-http_stub_status_module</p></blockquote>

<h2>Configurando un VirtualHost</h2>

<p><a href="https://gist.github.com/2373815">Aquí</a> les dejo mi archivo de configuración de <strong>nginx</strong>. Por supuesto lo deben guardar en un lugar donde nginx lo pueda encontrar. Si siguieron mi <a href="http://blog.malev.com.ar/rvm-plus-nginx-plus-server/">post anterior</a>, pueden colocarlo en: <strong>/opt/nginx/conf/conf.d/mycoolblog.conf</strong>.</p>

<h2>Reiniciamos y listo el pollo!</h2>

<blockquote><p>sudo mkdir /var/lib/nginx/</p>

<p>sudo /etc/init.d/php5-fcgi start</p>

<p>sudo /etc/init.d/nginx restart</p></blockquote>

<h2>Base de datos</h2>

<p>Lo más seguro es que tengan que crear una base de datos y un usuario por ejemplo para un Wordpress, aquí los pasos:</p>

<p>Ejecutamos:</p>

<blockquote><p>mysql -u root -p</p></blockquote>

<div class="highlight"><pre><code class="sql"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">database_name</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="n">database_name</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="ss">&quot;user&quot;</span> <span class="ss">&quot;localhost&quot;</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="ss">&quot;password&quot;</span><span class="p">;</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
<span class="n">EXIT</span>
</code></pre>
</div>


<h2>Resources</h2>

<ul>
<li>[1] http://cgit.stbuehler.de/gitosis/spawn-fcgi/about/</li>
<li>[2] codex.wordpress.org/Installing_WordPress</li>
<li>[3] http://internetmodulation.com/2011/01/11/install-wordpress-inside-passenger-app.html.html</li>
</ul>


    
      <div class="comments" style="margin-top: 20px;">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'malevsblog'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    
  </div>
  <div id="related">
    <h2><a href='/about.html'>About the author</a></h2>
  </div>

  <div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
      
        <li><span>01 Jun 2012</span> &raquo; <a href="/backbone-first-steps">Learning Javascript</a></li>
      
        <li><span>09 Apr 2012</span> &raquo; <a href="/learning-javascript">Learning Javascript</a></li>
      
        <li><span>08 Apr 2012</span> &raquo; <a href="/rvm-plus-nginx-plus-server">RVM plus Nginx plus Server</a></li>
      
    </ul>
  </div>
</div>
  <div class="site">
    <div class="footer">
      <div class="contact">
        <p style="margin:0;">
          <a href="/about.html">Marcos Vanetta</a> <strong>(malev)</strong><br />
          Software engineer<br />
          <a href="http://github.com/malev/">github</a> | <a href="http://twitter.com/malev/">twitter</a> | <a href="http://launchpad.net/~marcosvanetta">Launchpad</a>
        </p>
      </div>
      <div class="rss">
        <a href="http://feeds.feedburner.com/malev">
          <img src="/images/rss-logo.png" alt="Subscribe to RSS Feed" style="width: 64px;"/>
        </a>
      </div>
    </div>
  </div>
</div>
<a href="http://github.com/malev"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29516046-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
